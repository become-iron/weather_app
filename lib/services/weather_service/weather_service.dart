import 'dart:convert' show jsonDecode;

import 'package:geolocator/geolocator.dart' show Position;
import 'package:http/http.dart' as http;
import 'package:weather_app/services/weather_service/models/five_day_forecast.dart'
    show ForecastResponse;

// Docs: https://openweathermap.org/forecast5

// final responseDump = jsonDecode(
//     '{"cod":"200","message":0,"cnt":12,"list":[{"dt":1729846800,"main":{"temp":14.65,"feels_like":13.48,"temp_min":14.65,"temp_max":15.66,"pressure":1014,"sea_level":1014,"grnd_level":1014,"humidity":50,"temp_kf":-1.01},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":0},"wind":{"speed":0.64,"deg":93,"gust":0.87},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 09:00:00"},{"dt":1729857600,"main":{"temp":14.78,"feels_like":13.49,"temp_min":14.78,"temp_max":15.04,"pressure":1014,"sea_level":1014,"grnd_level":1014,"humidity":45,"temp_kf":-0.26},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":1},"wind":{"speed":0.45,"deg":129,"gust":0.76},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 12:00:00"},{"dt":1729868400,"main":{"temp":15.11,"feels_like":13.72,"temp_min":15.11,"temp_max":15.34,"pressure":1014,"sea_level":1014,"grnd_level":1014,"humidity":40,"temp_kf":-0.23},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":51},"wind":{"speed":0.88,"deg":130,"gust":1.08},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-25 15:00:00"},{"dt":1729879200,"main":{"temp":22.32,"feels_like":21.23,"temp_min":22.32,"temp_max":22.32,"pressure":1015,"sea_level":1015,"grnd_level":1015,"humidity":24,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":88},"wind":{"speed":0.6,"deg":125,"gust":1.27},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-25 18:00:00"},{"dt":1729890000,"main":{"temp":25.38,"feels_like":24.52,"temp_min":25.38,"temp_max":25.38,"pressure":1014,"sea_level":1014,"grnd_level":1014,"humidity":21,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":44},"wind":{"speed":1.98,"deg":323,"gust":2.29},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-25 21:00:00"},{"dt":1729900800,"main":{"temp":23.86,"feels_like":22.9,"temp_min":23.86,"temp_max":23.86,"pressure":1015,"sea_level":1015,"grnd_level":1015,"humidity":23,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":29},"wind":{"speed":2.73,"deg":309,"gust":3.27},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-26 00:00:00"},{"dt":1729911600,"main":{"temp":17.61,"feels_like":16.42,"temp_min":17.61,"temp_max":17.61,"pressure":1017,"sea_level":1017,"grnd_level":1017,"humidity":38,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":39},"wind":{"speed":1.42,"deg":293,"gust":2.29},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-26 03:00:00"},{"dt":1729922400,"main":{"temp":16.12,"feels_like":14.86,"temp_min":16.12,"temp_max":16.12,"pressure":1018,"sea_level":1018,"grnd_level":1018,"humidity":41,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03n"}],"clouds":{"all":28},"wind":{"speed":0.19,"deg":335,"gust":0.8},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-26 06:00:00"},{"dt":1729933200,"main":{"temp":15.25,"feels_like":13.9,"temp_min":15.25,"temp_max":15.25,"pressure":1019,"sea_level":1019,"grnd_level":1018,"humidity":41,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":5},"wind":{"speed":0.29,"deg":91,"gust":0.64},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-26 09:00:00"},{"dt":1729944000,"main":{"temp":14.82,"feels_like":13.38,"temp_min":14.82,"temp_max":14.82,"pressure":1018,"sea_level":1018,"grnd_level":1018,"humidity":39,"temp_kf":0},"weather":[{"id":800,"main":"Clear","description":"clear sky","icon":"01n"}],"clouds":{"all":9},"wind":{"speed":0.38,"deg":23,"gust":0.63},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-26 12:00:00"},{"dt":1729954800,"main":{"temp":14.95,"feels_like":13.49,"temp_min":14.95,"temp_max":14.95,"pressure":1019,"sea_level":1019,"grnd_level":1018,"humidity":38,"temp_kf":0},"weather":[{"id":802,"main":"Clouds","description":"scattered clouds","icon":"03d"}],"clouds":{"all":31},"wind":{"speed":0.49,"deg":37,"gust":0.68},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-26 15:00:00"},{"dt":1729965600,"main":{"temp":20.91,"feels_like":19.74,"temp_min":20.91,"temp_max":20.91,"pressure":1019,"sea_level":1019,"grnd_level":1019,"humidity":26,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04d"}],"clouds":{"all":60},"wind":{"speed":0.81,"deg":340,"gust":1.02},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-26 18:00:00"}],"city":{"id":5375480,"name":"Mountain View","coord":{"lat":37.4234,"lon":-122.084},"country":"US","population":74066,"timezone":-25200,"sunrise":1729866389,"sunset":1729905476}}');

final responseDump = jsonDecode(
    '{"cod":"200","message":0,"cnt":12,"list":[{"dt":1729846800,"main":{"temp":20.64,"feels_like":20.54,"temp_min":18.85,"temp_max":20.64,"pressure":1024,"sea_level":1024,"grnd_level":1018,"humidity":68,"temp_kf":1.79},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":2.49,"deg":349,"gust":3.97},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 09:00:00"},{"dt":1729857600,"main":{"temp":19.81,"feels_like":19.65,"temp_min":18.16,"temp_max":19.81,"pressure":1024,"sea_level":1024,"grnd_level":1018,"humidity":69,"temp_kf":1.65},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.92,"deg":353,"gust":2.84},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 12:00:00"},{"dt":1729868400,"main":{"temp":19.06,"feels_like":18.8,"temp_min":18.27,"temp_max":19.06,"pressure":1024,"sea_level":1024,"grnd_level":1018,"humidity":68,"temp_kf":0.79},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.44,"deg":14,"gust":1.96},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 15:00:00"},{"dt":1729879200,"main":{"temp":18.51,"feels_like":18.32,"temp_min":18.51,"temp_max":18.51,"pressure":1023,"sea_level":1023,"grnd_level":1016,"humidity":73,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.54,"deg":36,"gust":2.03},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 18:00:00"},{"dt":1729890000,"main":{"temp":18.66,"feels_like":18.57,"temp_min":18.66,"temp_max":18.66,"pressure":1022,"sea_level":1022,"grnd_level":1016,"humidity":76,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.57,"deg":41,"gust":2.07},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-25 21:00:00"},{"dt":1729900800,"main":{"temp":20.76,"feels_like":20.77,"temp_min":20.76,"temp_max":20.76,"pressure":1022,"sea_level":1022,"grnd_level":1016,"humidity":72,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":1.54,"deg":69,"gust":2.36},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-26 00:00:00"},{"dt":1729911600,"main":{"temp":22.92,"feels_like":22.99,"temp_min":22.92,"temp_max":22.92,"pressure":1020,"sea_level":1020,"grnd_level":1014,"humidity":66,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":1.74,"deg":70,"gust":2.82},"visibility":10000,"pop":0,"sys":{"pod":"d"},"dt_txt":"2024-10-26 03:00:00"},{"dt":1729922400,"main":{"temp":23.06,"feels_like":23.17,"temp_min":23.06,"temp_max":23.06,"pressure":1019,"sea_level":1019,"grnd_level":1013,"humidity":67,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04d"}],"clouds":{"all":100},"wind":{"speed":1.27,"deg":53,"gust":2.36},"visibility":10000,"pop":0.01,"sys":{"pod":"d"},"dt_txt":"2024-10-26 06:00:00"},{"dt":1729933200,"main":{"temp":21.26,"feels_like":21.4,"temp_min":21.26,"temp_max":21.26,"pressure":1019,"sea_level":1019,"grnd_level":1013,"humidity":75,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.01,"deg":44,"gust":1.54},"visibility":10000,"pop":0.09,"sys":{"pod":"n"},"dt_txt":"2024-10-26 09:00:00"},{"dt":1729944000,"main":{"temp":20.48,"feels_like":20.65,"temp_min":20.48,"temp_max":20.48,"pressure":1019,"sea_level":1019,"grnd_level":1013,"humidity":79,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.23,"deg":54,"gust":1.67},"visibility":10000,"pop":0.05,"sys":{"pod":"n"},"dt_txt":"2024-10-26 12:00:00"},{"dt":1729954800,"main":{"temp":19.33,"feels_like":19.49,"temp_min":19.33,"temp_max":19.33,"pressure":1018,"sea_level":1018,"grnd_level":1012,"humidity":83,"temp_kf":0},"weather":[{"id":804,"main":"Clouds","description":"overcast clouds","icon":"04n"}],"clouds":{"all":100},"wind":{"speed":1.34,"deg":53,"gust":2.25},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-26 15:00:00"},{"dt":1729965600,"main":{"temp":18.15,"feels_like":18.29,"temp_min":18.15,"temp_max":18.15,"pressure":1017,"sea_level":1017,"grnd_level":1011,"humidity":87,"temp_kf":0},"weather":[{"id":803,"main":"Clouds","description":"broken clouds","icon":"04n"}],"clouds":{"all":53},"wind":{"speed":1.67,"deg":55,"gust":2.29},"visibility":10000,"pop":0,"sys":{"pod":"n"},"dt_txt":"2024-10-26 18:00:00"}],"city":{"id":1852524,"name":"Shijōdōri","coord":{"lat":34.9866,"lon":135.7739},"country":"JP","population":0,"timezone":32400,"sunrise":1729804273,"sunset":1729843829}}');

class WeatherService {
  static final client = http.Client();
  static const weatherServiceHost = 'api.openweathermap.org';

  static Future<ForecastResponse> getWeatherData(Position position) async {
    // TODO: temp
    return ForecastResponse.fromJson(responseDump);
    // final http.Response response;
    // try {
    //   response = await client.get(Uri.https(
    //     weatherServiceHost,
    //     '/data/2.5/forecast',
    //     {
    //       'lat': '${position.latitude}',
    //       'lon': '${position.longitude}',
    //       'appid': appConfig.weatherService.appId,
    //       'units': 'metric',
    //       'cnt': '12',
    //     },
    //   ));
    // } finally {
    //   client.close();
    // }
    //
    // return jsonDecode(response.body) as Map;
  }
}
